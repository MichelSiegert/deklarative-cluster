- name: Update apt cache
  apt:
    update_cache: yes
    cache_valid_time: 3600
  become: yes

- name: Install NFS kernel server
  apt:
    name: nfs-kernel-server
    state: present
  become: yes

- name: Create /opt/sfw directory
  file:
    path: /opt/sfw
    state: directory
    mode: "1777"
  become: yes

- name: Ensure NFS export entry exists
  lineinfile:
    path: /etc/exports
    line: "/opt/sfw *(rw,sync,no_root_squash,subtree_check)"
    state: present
    create: yes
  notify: Reload NFS exports
  become: yes